SELECT *
FROM CASE_STUDY_SALES.PUBLIC.SALES;

----DATE FORMATTED

CREATE OR REPLACE TABLE SALES_TRENDS AS (
SELECT *,
       TO_DATE (DATE,'DD/MM/YYYY') AS FORMATTED_DATE
FROM SALES);

SELECT *
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS;

SELECT MIN(FORMATTED_DATE) AS FIRST_TRANSACTION,
       MAX (FORMATTED_DATE) AS FINAL_TRANSACTION
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS;

ALTER TABLE SALES_TRENDS DROP DATE;
SELECT *
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS;

SELECT FORMATTED_DATE,
       TO_CHAR(FORMATTED_DATE,'DY')AS DAY_OF_THE_WEEK,
       TRUNCATE(SALES, 2) AS SALES,
       TRUNCATE(COST_OF_SALES, 2) AS COST_OF_SALES,
       QUANTITY_SOLD,
       TRUNCATE (SALES/QUANTITY_SOLD, 2) AS PRICE_PER_UNIT,
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS;

---CREATING ANOTHER TABLE
CREATE OR REPLACE TABLE SALES_TRENDS_FINAL AS (
SELECT *,
       TO_CHAR(FORMATTED_DATE,'DY')AS DAY_OF_THE_WEEK,
       TRUNCATE(SALES, 2) AS SALES_FINAL,
       TRUNCATE(COST_OF_SALES, 2) AS COST_OF_SALES_FINAL,
       TRUNCATE (SALES/QUANTITY_SOLD, 2) AS PRICE_PER_UNIT
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS);

SELECT *
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL

--DROPPING COLUNMS
ALTER TABLE SALES_TRENDS_FINAL DROP SALES, COST_OF_SALES;
SELECT *
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;

--AVARAGE UNIT SALES
SELECT COUNT (FORMATTED_DATE) AS NUMBER_OF_UNITS
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;

--QUESTION 2 
SELECT SUM(PRICE_PER_UNIT)/1053 AS AVERAGE_UNIT_SALES_PRICE
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;

-- GROSS PERCENTAGE PROFIT AND GROSS PROFIT
SELECT FORMATTED_DATE,
       TRUNCATE((SALES_FINAL-COST_OF_SALES_FINAL) /COST_OF_SALES_FINAL*100, 1) AS DAILY_PERCENTAGE_GROSS_PROFIT
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;


---GROSS PERCENTAGE PROFIT PER UNIT AND GROSS PROFIT
SELECT FORMATTED_DATE,
       TRUNCATE ((SALES_FINAL-COST_OF_SALES)/ QUANTITY_SOLD*100, 1) AS DAILY_PERCENTAGE_PRICE_PER_UNIT
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;

---GROSS PROFIT PER UNIT
SELECT FORMATTED_DATE,
       (SALES_FINAL-COST_OF_SALES_FINAL) AS PROFIT
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL;
       
---CREATING A FINAL TABLE
CREATE OR REPLACE TABLE SALES_TABLE AS (
SELECT FORMATTED_DATE,
       DAY_OF_THE_WEEK,
       TRUNCATE (SALES_FINAL) AS SALES,
       TRUNCATE (COST_OF_SALES_FINAL) AS COST_OF_SALES,
       TRUNCATE (SALES/QUANTITY_SOLD) AS PRICE_PER_UNIT,
       QUANTITY_SOLD,
       TRUNCATE((SALES_FINAL-COST_OF_SALES_FINAL) /COST_OF_SALES_FINAL*100) AS DAILY_PERCENTAGE_GROSS_PROFIT,
       TRUNCATE ((SALES_FINAL-COST_OF_SALES)/ QUANTITY_SOLD*100) AS DAILY_PERCENTAGE_PRICE_PER_UNIT,
       TRUNCATE (SALES_FINAL-COST_OF_SALES_FINAL) AS PROFIT
FROM CASE_STUDY_SALES.PUBLIC.SALES_TRENDS_FINAL );

SELECT *
FROM SALES_TABLE;

 ---QUESTION 5
 SELECT FORMATTED_DATE,
        PRICE_PER_UNIT
 FROM SALES_TABLE
 ORDER BY PRICE_PER_UNIT ASC
 LIMIT 3;

 SELECT FORMATTED_DATE,
        PRICE_PER_UNIT,
        QUANTITY_SOLD
FROM CASE_STUDY_SALES.PUBLIC.SALES_TABLE
WHERE FORMATTED_DATE ='2014-08-28'
